<div class="card">
    <p-select [options]="[{ name: 'Compra', code: 'compra' }, { name: 'Venta', code: 'venta' }]" (onChange)="getListaNotas()" optionLabel="name" optionValue="code" placeholder="Seleccionar Tipo" class="w-full md:w-56" [(ngModel)]="selectedTipo" />

{{selectedTipo()}}
    <p-table [value]="notas()" [tableStyle]="{ 'min-width': '50rem' }" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5, 10, 20]" [lazy]="true" [totalRecords]="totalRecords()" [loading]="loading()" (onLazyLoad)="cargarDatos($event)">
        <ng-template #header>
            <tr>
                <th>FECHA</th>
                <th>TIPO NOTA</th>
                <th>CLIENTE/PROVEEDOR</th>
                <th>ATENDIDO POR</th>
                <th>Items</th>
                <th></th>
            </tr>
        </ng-template>
        <ng-template #body let-nota>
            <tr>
                <td>{{ getFecha(nota.fecha) }}</td>
                <td><span class="px-2 py-0.5 rounded text-[11px] bg-blue-100 text-blue-700">
                        {{ nota.tipo_nota }}
                    </span></td>
                <td class="px-2 py-1 align-top">
                    <div class="leading-tight">
                        <p class="text-xs font-semibold text-gray-800 truncate max-w-[180px]">
                            {{ nota.cliente.tipo }}: {{ nota.cliente.razon_social }}
                        </p>
                        <p class="text-[11px] text-gray-500 truncate max-w-[180px]">
                            {{ nota.cliente.identificacion }} · {{ nota.cliente.telefono }}
                        </p>
                    </div>
                </td>


                <td class="px-2 py-1 align-top">
                    <div class="leading-tight">
                        <p class="text-xs font-medium text-gray-800 truncate max-w-[140px]">
                            {{ nota.user.username }}
                        </p>
                        <p class="text-[11px] text-gray-500 truncate max-w-[140px]">
                            {{ nota.user.email }}
                        </p>
                    </div>
                </td>
                <!-- Ítems -->
                <td class="px-2 py-1 text-center">
                    ({{ nota.movimientos.length }})

                    <p-button (click)="showMovimientos(nota)" label="VER" />


                </td>

            </tr>
        </ng-template>
    </p-table>
</div>

<p-dialog header="Movimientos" [modal]="true" [(visible)]="visible" [style]="{ width: '50rem' }">
    <span class="p-text-secondary block mb-8">Movimientos.</span>
    <p-table [value]="movimientos()" [tableStyle]="{ 'min-width': '50rem' }" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5, 10, 20]">
        <ng-template #header>
            <tr>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Tipo Mov.</th>
                <th>Observaciones</th>
            </tr>
        </ng-template>
        <ng-template #body let-mov>
            <tr>
                <td>{{ mov.producto.nombre }}</td>
                <td>{{ mov.cantidad }}</td>
                <td>{{ mov.tipo_movimiento }}</td>
                <td>{{ mov.observaciones }}</td>
            </tr>
        </ng-template>
    </p-table>
    <div class="flex justify-end gap-2">
        <p-button label="Cancel" severity="secondary" (click)="visible.set(false)" />
    </div>
</p-dialog>